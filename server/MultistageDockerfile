# Using lightweight alpine image
FROM python:3.6-alpine AS compile-image

# Installing packages
RUN apk add --update

COPY ./requirements.txt ./requirements.txt


# # Defining working directory and adding source code
# WORKDIR /app
# RUN pip install --upgrade certificate
RUN pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org --user -r ./requirements.txt

COPY setup.py .
COPY server.py .

RUN python setup.py sdist
RUN pip install --user .

FROM python:3.6-alpine AS build-image
COPY --from=compile-image /root/.local /root/.local

ENV PATH=/root/.local/bin:$PATH
# CMD ['myapp']
# # COPY server.py ./


# ENTRYPOINT [ "python" ]

CMD [ "server.py" ]